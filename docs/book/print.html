<!DOCTYPE HTML>
<html lang="en" class="navy sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Mimir - D&amp;D Campaign Assistant</title>
        <meta name="robots" content="noindex">


        <!-- Custom HTML head -->

        <meta name="description" content="A local-first D&amp;D campaign assistant for Dungeon Masters">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="highlight.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="tomorrow-night.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "";
            const default_light_theme = "navy";
            const default_dark_theme = "navy";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="toc.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>‚Üê</kbd> or <kbd>‚Üí</kbd> to navigate between chapters</p>
                <p>Press <kbd>S</kbd> or <kbd>/</kbd> to search in the book</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('navy')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search (`/`)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="/ s" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Mimir - D&amp;D Campaign Assistant</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/yourusername/mimir" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="mimir---dd-campaign-assistant"><a class="header" href="#mimir---dd-campaign-assistant">Mimir - D&amp;D Campaign Assistant</a></h1>
<blockquote>
<p><em>‚ÄúRemember, I know everything that can be known in the multiverse.‚Äù</em> - Mimir, Planescape</p>
</blockquote>
<p>Welcome to Mimir, a local-first D&amp;D campaign assistant designed to help Dungeon Masters manage the cognitive complexity of running campaigns. Named after the wise floating skull of Planescape lore, Mimir focuses on narrative consistency, NPC management, plot tracking, and session preparation.</p>
<h2 id="what-is-mimir"><a class="header" href="#what-is-mimir">What is Mimir?</a></h2>
<p>Mimir is a <strong>terminal-based application</strong> built in Rust that serves as your intelligent campaign companion. Unlike online tools that require internet connectivity, Mimir runs entirely on your local machine, keeping your campaign data private and always accessible.</p>
<h3 id="key-features"><a class="header" href="#key-features">Key Features</a></h3>
<ul>
<li>üß† <strong>Local AI Integration</strong> - Uses Ollama for privacy-focused AI assistance</li>
<li>üë• <strong>Intelligent NPC Management</strong> - Track personalities, relationships, and consistency</li>
<li>üï∏Ô∏è <strong>Plot Thread Visualization</strong> - Connect story elements and detect narrative patterns</li>
<li>üìù <strong>Session Preparation Tools</strong> - Streamlined prep and execution support</li>
<li>üîç <strong>Hybrid Search</strong> - Combines exact keyword matching with semantic understanding</li>
<li>üíª <strong>Beautiful Terminal UI</strong> - Clean, responsive interface built with Ratatui</li>
<li>üîí <strong>Privacy-First</strong> - Your campaign data never leaves your machine</li>
</ul>
<h2 id="quick-start"><a class="header" href="#quick-start">Quick Start</a></h2>
<p>If you‚Äôre new to Mimir, start with our <strong><a href="./tutorials/getting-started.html">Getting Started Tutorial</a></strong> to install and configure the application.</p>
<p>For your first campaign, follow the <strong><a href="./tutorials/first-campaign.html">Your First Campaign</a></strong> guide.</p>
<h2 id="documentation-structure"><a class="header" href="#documentation-structure">Documentation Structure</a></h2>
<p>This documentation follows the <a href="https://diataxis.fr/">Di√°taxis</a> framework:</p>
<ul>
<li><strong><a href="./tutorials/getting-started.html">Tutorials</a></strong> - Learning-oriented guides to get you started</li>
<li><strong><a href="./how-to/campaign-management.html">How-To Guides</a></strong> - Goal-oriented solutions for specific tasks</li>
<li><strong><a href="./reference/cli-commands.html">Reference</a></strong> - Information-oriented technical details</li>
<li><strong><a href="./explanation/architecture.html">Explanation</a></strong> - Understanding-oriented background and context</li>
</ul>
<h2 id="technology-stack"><a class="header" href="#technology-stack">Technology Stack</a></h2>
<ul>
<li><strong>Language</strong>: Rust ü¶Ä</li>
<li><strong>Database</strong>: SQLite with <a href="https://github.com/asg017/sqlite-vec">sqlite-vec</a> for vector search</li>
<li><strong>AI</strong>: <a href="https://ollama.ai/">Ollama</a> with llama3/mistral models</li>
<li><strong>UI</strong>: <a href="https://ratatui.rs/">Ratatui</a> terminal user interface</li>
<li><strong>Search</strong>: Hybrid FTS5 + vector similarity search</li>
</ul>
<h2 id="project-status"><a class="header" href="#project-status">Project Status</a></h2>
<p>üöß <strong>Under Active Development</strong> - Mimir is currently in early development (v0.0.0).</p>
<p>See our <a href="./explanation/architecture.html#development-roadmap">project roadmap</a> for current progress and upcoming features.</p>
<h2 id="getting-help"><a class="header" href="#getting-help">Getting Help</a></h2>
<ul>
<li><strong>Issues</strong>: Report bugs or request features on <a href="https://github.com/yourusername/mimir/issues">GitHub Issues</a></li>
<li><strong>Discussions</strong>: Join community discussions on <a href="https://github.com/yourusername/mimir/discussions">GitHub Discussions</a></li>
<li><strong>Troubleshooting</strong>: Check our <a href="./how-to/troubleshooting.html">troubleshooting guide</a></li>
</ul>
<h2 id="license"><a class="header" href="#license">License</a></h2>
<p>Licensed under either of Apache License, Version 2.0 or MIT license at your option.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="getting-started"><a class="header" href="#getting-started">Getting Started</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="your-first-campaign"><a class="header" href="#your-first-campaign">Your First Campaign</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="setting-up-ollama"><a class="header" href="#setting-up-ollama">Setting Up Ollama</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="campaign-management"><a class="header" href="#campaign-management">Campaign Management</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="npc-creation--management"><a class="header" href="#npc-creation--management">NPC Creation &amp; Management</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="plot-tracking"><a class="header" href="#plot-tracking">Plot Tracking</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="database-operations"><a class="header" href="#database-operations">Database Operations</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="troubleshooting"><a class="header" href="#troubleshooting">Troubleshooting</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="cli-commands"><a class="header" href="#cli-commands">CLI Commands</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="configuration"><a class="header" href="#configuration">Configuration</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="database-schema-reference"><a class="header" href="#database-schema-reference">Database Schema Reference</a></h1>
<p>This section documents the complete database schema for Mimir, including table structures, relationships, and indexing strategies.</p>
<h2 id="database-architecture"><a class="header" href="#database-architecture">Database Architecture</a></h2>
<pre class="mermaid">graph TB
    subgraph &quot;Core Data Tables&quot;
        C[campaigns]
        N[npcs]
        P[plots]
        S[sessions]
        R[rules]
    end
    
    subgraph &quot;Search Infrastructure&quot;
        subgraph &quot;FTS5 Tables&quot;
            NF[npcs_fts]
            PF[plots_fts]
            SF[sessions_fts]
            RF[rules_fts]
        end
        
        subgraph &quot;Vector Search&quot;
            E[embeddings&lt;br/&gt;vec0 virtual table]
            EM[embedding_metadata]
        end
    end
    
    %% Core relationships
    C --&gt;|campaign_id| N
    C --&gt;|campaign_id| P
    C --&gt;|campaign_id| S
    
    %% FTS5 sync triggers
    N -.-&gt;|triggers| NF
    P -.-&gt;|triggers| PF
    S -.-&gt;|triggers| SF
    R -.-&gt;|triggers| RF
    
    %% Vector embeddings
    E --&gt;|rowid| EM
    N -.-&gt;|content| EM
    P -.-&gt;|content| EM
    R -.-&gt;|content| EM
    S -.-&gt;|content| EM
    
    classDef coreTable fill:#e1f5fe
    classDef searchTable fill:#f3e5f5
    classDef vectorTable fill:#e8f5e8
    
    class C,N,P,S,R coreTable
    class NF,PF,SF,RF searchTable
    class E,EM vectorTable
</pre>
<h2 id="core-tables"><a class="header" href="#core-tables">Core Tables</a></h2>
<h3 id="campaigns"><a class="header" href="#campaigns">Campaigns</a></h3>
<p>Primary entity representing D&amp;D campaigns:</p>
<pre><code class="language-sql">CREATE TABLE campaigns (
    id TEXT PRIMARY KEY NOT NULL,
    name TEXT NOT NULL,
    description TEXT,
    settings TEXT, -- JSON serialized settings
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP
);
</code></pre>
<ul>
<li><strong>id</strong>: UUID primary key</li>
<li><strong>name</strong>: Human-readable campaign name</li>
<li><strong>description</strong>: Optional campaign overview</li>
<li><strong>settings</strong>: JSON-serialized campaign configuration</li>
<li><strong>created_at/updated_at</strong>: Audit timestamps</li>
</ul>
<h3 id="npcs"><a class="header" href="#npcs">NPCs</a></h3>
<p>Non-player character definitions linked to campaigns:</p>
<pre><code class="language-sql">CREATE TABLE npcs (
    id TEXT PRIMARY KEY NOT NULL,
    campaign_id TEXT NOT NULL,
    name TEXT NOT NULL,
    description TEXT,
    personality TEXT,
    relationships TEXT, -- JSON serialized relationships
    stats TEXT, -- JSON serialized stats
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (campaign_id) REFERENCES campaigns (id) ON DELETE CASCADE
);
</code></pre>
<ul>
<li><strong>campaign_id</strong>: Links to parent campaign</li>
<li><strong>name</strong>: NPC name</li>
<li><strong>description</strong>: Physical description and background</li>
<li><strong>personality</strong>: Character traits and motivations</li>
<li><strong>relationships</strong>: JSON-encoded relationships to other NPCs/PCs</li>
<li><strong>stats</strong>: JSON-encoded mechanical statistics</li>
</ul>
<h3 id="plots"><a class="header" href="#plots">Plots</a></h3>
<p>Story arc and plot thread tracking:</p>
<pre><code class="language-sql">CREATE TABLE plots (
    id TEXT PRIMARY KEY NOT NULL,
    campaign_id TEXT NOT NULL,
    title TEXT NOT NULL,
    summary TEXT,
    status TEXT NOT NULL DEFAULT 'active', -- active, paused, completed
    connections TEXT, -- JSON serialized connections to NPCs/other plots
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (campaign_id) REFERENCES campaigns (id) ON DELETE CASCADE
);
</code></pre>
<ul>
<li><strong>status</strong>: Plot lifecycle state (active, paused, completed)</li>
<li><strong>connections</strong>: JSON-encoded links to NPCs and other plots</li>
<li><strong>summary</strong>: Plot description and current state</li>
</ul>
<h3 id="sessions"><a class="header" href="#sessions">Sessions</a></h3>
<p>Individual game session records:</p>
<pre><code class="language-sql">CREATE TABLE sessions (
    id TEXT PRIMARY KEY NOT NULL,
    campaign_id TEXT NOT NULL,
    session_number INTEGER NOT NULL,
    date DATE NOT NULL,
    summary TEXT,
    notes TEXT,
    participants TEXT, -- JSON serialized list of participants
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (campaign_id) REFERENCES campaigns (id) ON DELETE CASCADE,
    UNIQUE(campaign_id, session_number)
);
</code></pre>
<ul>
<li><strong>session_number</strong>: Sequential session numbering within campaign</li>
<li><strong>participants</strong>: JSON-encoded player/character information</li>
<li><strong>summary</strong>: Session recap</li>
<li><strong>notes</strong>: DM notes and observations</li>
</ul>
<h3 id="rules"><a class="header" href="#rules">Rules</a></h3>
<p>D&amp;D rule references and custom house rules:</p>
<pre><code class="language-sql">CREATE TABLE rules (
    id TEXT PRIMARY KEY NOT NULL,
    title TEXT NOT NULL,
    content TEXT NOT NULL,
    category TEXT NOT NULL, -- spell, class, race, item, etc.
    source TEXT, -- PHB, DMG, etc.
    page_reference TEXT,
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP
);
</code></pre>
<ul>
<li><strong>category</strong>: Rule classification (spell, class, race, item, etc.)</li>
<li><strong>source</strong>: Book reference (PHB, DMG, XGE, etc.)</li>
<li><strong>page_reference</strong>: Specific page citation</li>
</ul>
<h2 id="search-infrastructure"><a class="header" href="#search-infrastructure">Search Infrastructure</a></h2>
<h3 id="full-text-search-fts5"><a class="header" href="#full-text-search-fts5">Full-Text Search (FTS5)</a></h3>
<p>Optimized search across all content types using SQLite‚Äôs FTS5:</p>
<pre><code class="language-sql">-- Example: Rules FTS table
CREATE VIRTUAL TABLE rules_fts USING fts5(
    rule_id UNINDEXED,
    title,
    content,
    category,
    tokenize='porter unicode61 remove_diacritics 2'
);
</code></pre>
<p>Features:</p>
<ul>
<li><strong>Porter stemming</strong>: Matches related word forms</li>
<li><strong>Unicode support</strong>: Handles special characters</li>
<li><strong>Diacritic removal</strong>: Ignores accents</li>
<li><strong>Automatic triggers</strong>: Keep FTS tables synchronized</li>
</ul>
<h3 id="vector-search-sqlite-vec"><a class="header" href="#vector-search-sqlite-vec">Vector Search (sqlite-vec)</a></h3>
<p>Semantic similarity search using embeddings:</p>
<pre><code class="language-sql">-- Vector storage for 384-dimensional embeddings
CREATE VIRTUAL TABLE embeddings USING vec0(
    embedding float[384] -- nomic-embed-text produces 384-dimensional vectors
);

-- Metadata table for vector context
CREATE TABLE embedding_metadata (
    rowid INTEGER PRIMARY KEY,
    content_type TEXT NOT NULL,
    content_id TEXT NOT NULL,
    content_text TEXT NOT NULL,
    created_at TEXT NOT NULL DEFAULT CURRENT_TIMESTAMP
);
</code></pre>
<ul>
<li><strong>384 dimensions</strong>: Compatible with nomic-embed-text model</li>
<li><strong>Content linking</strong>: Maps vectors to source content</li>
<li><strong>Semantic search</strong>: Find conceptually similar content</li>
</ul>
<h2 id="performance-optimization"><a class="header" href="#performance-optimization">Performance Optimization</a></h2>
<h3 id="indexes"><a class="header" href="#indexes">Indexes</a></h3>
<p>Strategic indexing for common query patterns:</p>
<pre><code class="language-sql">-- Campaign-based queries
CREATE INDEX idx_npcs_campaign_id ON npcs(campaign_id);
CREATE INDEX idx_plots_campaign_id ON plots(campaign_id);
CREATE INDEX idx_sessions_campaign_id ON sessions(campaign_id);

-- Search and filtering
CREATE INDEX idx_plots_status ON plots(status);
CREATE INDEX idx_rules_category ON rules(category);
CREATE INDEX idx_sessions_date ON sessions(date);
</code></pre>
<h3 id="query-patterns"><a class="header" href="#query-patterns">Query Patterns</a></h3>
<ul>
<li><strong>Campaign isolation</strong>: All queries scope to specific campaigns</li>
<li><strong>Hybrid search</strong>: Combine FTS5 and vector search results</li>
<li><strong>Efficient joins</strong>: Foreign key relationships with proper indexing</li>
</ul>
<h2 id="migration-management"><a class="header" href="#migration-management">Migration Management</a></h2>
<p>Database schema is managed through Diesel migrations:</p>
<ol>
<li><strong>2025-07-28-000001_create_core_tables</strong>: Core entity tables</li>
<li><strong>2025-07-28-000002_create_search_tables</strong>: FTS5 and vector search</li>
</ol>
<p>Migration commands:</p>
<pre><code class="language-bash"># Setup database
make db-setup

# Run migrations
make db-migrate

# Reset database
make db-reset
</code></pre>
<h2 id="data-integrity"><a class="header" href="#data-integrity">Data Integrity</a></h2>
<ul>
<li><strong>Foreign key constraints</strong>: Ensure referential integrity</li>
<li><strong>Cascade deletes</strong>: Campaign deletion removes all related data</li>
<li><strong>Unique constraints</strong>: Prevent duplicate session numbers</li>
<li><strong>Automatic triggers</strong>: Maintain search index consistency</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="data-models-reference"><a class="header" href="#data-models-reference">Data Models Reference</a></h1>
<p>This section documents the Diesel ORM models used in the Mimir database layer. These models provide type-safe database operations and automatic serialization/deserialization.</p>
<h2 id="entity-relationships"><a class="header" href="#entity-relationships">Entity Relationships</a></h2>
<pre class="mermaid">erDiagram
    Campaign ||--o{ NPC : contains
    Campaign ||--o{ Plot : contains
    Campaign ||--o{ Session : contains
    Campaign {
        string id PK
        string name
        string description
        string settings &quot;JSON&quot;
        datetime created_at
        datetime updated_at
    }
    
    NPC {
        string id PK
        string campaign_id FK
        string name
        string description
        string personality
        string relationships &quot;JSON&quot;
        string stats &quot;JSON&quot;
        datetime created_at
        datetime updated_at
    }
    
    Plot {
        string id PK
        string campaign_id FK
        string title
        string summary
        string status
        string connections &quot;JSON&quot;
        datetime created_at
        datetime updated_at
    }
    
    Session {
        string id PK
        string campaign_id FK
        int session_number
        date date
        string summary
        string notes
        string participants &quot;JSON&quot;
        datetime created_at
        datetime updated_at
    }
    
    Rule {
        string id PK
        string title
        string content
        string category
        string source
        string page_reference
        datetime created_at
        datetime updated_at
    }
    
    EmbeddingMetadata {
        int rowid PK
        string content_type
        string content_id
        string content_text
        string created_at
    }
</pre>
<h2 id="model-structure"><a class="header" href="#model-structure">Model Structure</a></h2>
<p>Each entity has three model variants:</p>
<ul>
<li><strong>Base model</strong>: For querying existing records</li>
<li><strong>New model</strong>: For inserting new records (excludes auto-generated fields)</li>
<li><strong>Update model</strong>: For modifying existing records (all fields optional)</li>
</ul>
<h2 id="campaign-models"><a class="header" href="#campaign-models">Campaign Models</a></h2>
<h3 id="campaign"><a class="header" href="#campaign">Campaign</a></h3>
<p>Primary model for D&amp;D campaigns:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>#[derive(Debug, Clone, PartialEq, Eq, Queryable, Selectable, Serialize, Deserialize)]
#[diesel(table_name = campaigns)]
pub struct Campaign {
    pub id: String,
    pub name: String,
    pub description: Option&lt;String&gt;,
    pub settings: Option&lt;String&gt;, // JSON serialized CampaignSettings
    pub created_at: NaiveDateTime,
    pub updated_at: NaiveDateTime,
}
<span class="boring">}</span></code></pre></pre>
<h3 id="newcampaign"><a class="header" href="#newcampaign">NewCampaign</a></h3>
<p>For creating new campaigns:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>#[derive(Debug, Clone, PartialEq, Eq, Insertable, Serialize, Deserialize)]
#[diesel(table_name = campaigns)]
pub struct NewCampaign {
    pub id: String,
    pub name: String,
    pub description: Option&lt;String&gt;,
    pub settings: Option&lt;String&gt;,
}
<span class="boring">}</span></code></pre></pre>
<h3 id="updatecampaign"><a class="header" href="#updatecampaign">UpdateCampaign</a></h3>
<p>For modifying existing campaigns:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>#[derive(Debug, Clone, PartialEq, Eq, AsChangeset, Serialize, Deserialize)]
#[diesel(table_name = campaigns)]
pub struct UpdateCampaign {
    pub name: Option&lt;String&gt;,
    pub description: Option&lt;String&gt;,
    pub settings: Option&lt;String&gt;,
    pub updated_at: NaiveDateTime,
}
<span class="boring">}</span></code></pre></pre>
<h2 id="npc-models"><a class="header" href="#npc-models">NPC Models</a></h2>
<h3 id="npc"><a class="header" href="#npc">Npc</a></h3>
<p>Model for non-player characters:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>#[derive(Debug, Clone, PartialEq, Eq, Queryable, Selectable, Serialize, Deserialize)]
#[diesel(table_name = npcs)]
pub struct Npc {
    pub id: String,
    pub campaign_id: String,
    pub name: String,
    pub description: Option&lt;String&gt;,
    pub personality: Option&lt;String&gt;,
    pub relationships: Option&lt;String&gt;, // JSON serialized
    pub stats: Option&lt;String&gt;, // JSON serialized
    pub created_at: NaiveDateTime,
    pub updated_at: NaiveDateTime,
}
<span class="boring">}</span></code></pre></pre>
<h3 id="newnpc"><a class="header" href="#newnpc">NewNpc</a></h3>
<p>For creating new NPCs:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>#[derive(Debug, Clone, PartialEq, Eq, Insertable, Serialize, Deserialize)]
#[diesel(table_name = npcs)]
pub struct NewNpc {
    pub id: String,
    pub campaign_id: String,
    pub name: String,
    pub description: Option&lt;String&gt;,
    pub personality: Option&lt;String&gt;,
    pub relationships: Option&lt;String&gt;,
    pub stats: Option&lt;String&gt;,
}
<span class="boring">}</span></code></pre></pre>
<h3 id="updatenpc"><a class="header" href="#updatenpc">UpdateNpc</a></h3>
<p>For modifying existing NPCs:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>#[derive(Debug, Clone, PartialEq, Eq, AsChangeset, Serialize, Deserialize)]
#[diesel(table_name = npcs)]
pub struct UpdateNpc {
    pub name: Option&lt;String&gt;,
    pub description: Option&lt;String&gt;,
    pub personality: Option&lt;String&gt;,
    pub relationships: Option&lt;String&gt;,
    pub stats: Option&lt;String&gt;,
    pub updated_at: NaiveDateTime,
}
<span class="boring">}</span></code></pre></pre>
<h2 id="plot-models"><a class="header" href="#plot-models">Plot Models</a></h2>
<h3 id="plot"><a class="header" href="#plot">Plot</a></h3>
<p>Model for story arcs and plot threads:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>#[derive(Debug, Clone, PartialEq, Eq, Queryable, Selectable, Serialize, Deserialize)]
#[diesel(table_name = plots)]
pub struct Plot {
    pub id: String,
    pub campaign_id: String,
    pub title: String,
    pub summary: Option&lt;String&gt;,
    pub status: String, // "active", "paused", "completed"
    pub connections: Option&lt;String&gt;, // JSON serialized
    pub created_at: NaiveDateTime,
    pub updated_at: NaiveDateTime,
}
<span class="boring">}</span></code></pre></pre>
<h3 id="newplot"><a class="header" href="#newplot">NewPlot</a></h3>
<p>For creating new plots:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>#[derive(Debug, Clone, PartialEq, Eq, Insertable, Serialize, Deserialize)]
#[diesel(table_name = plots)]
pub struct NewPlot {
    pub id: String,
    pub campaign_id: String,
    pub title: String,
    pub summary: Option&lt;String&gt;,
    pub status: String,
    pub connections: Option&lt;String&gt;,
}
<span class="boring">}</span></code></pre></pre>
<h3 id="updateplot"><a class="header" href="#updateplot">UpdatePlot</a></h3>
<p>For modifying existing plots:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>#[derive(Debug, Clone, PartialEq, Eq, AsChangeset, Serialize, Deserialize)]
#[diesel(table_name = plots)]
pub struct UpdatePlot {
    pub title: Option&lt;String&gt;,
    pub summary: Option&lt;String&gt;,
    pub status: Option&lt;String&gt;,
    pub connections: Option&lt;String&gt;,
    pub updated_at: NaiveDateTime,
}
<span class="boring">}</span></code></pre></pre>
<h2 id="session-models"><a class="header" href="#session-models">Session Models</a></h2>
<h3 id="session"><a class="header" href="#session">Session</a></h3>
<p>Model for game sessions:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>#[derive(Debug, Clone, PartialEq, Eq, Queryable, Selectable, Serialize, Deserialize)]
#[diesel(table_name = sessions)]
pub struct Session {
    pub id: String,
    pub campaign_id: String,
    pub session_number: i32,
    pub date: chrono::NaiveDate,
    pub summary: Option&lt;String&gt;,
    pub notes: Option&lt;String&gt;,
    pub participants: Option&lt;String&gt;, // JSON serialized
    pub created_at: NaiveDateTime,
    pub updated_at: NaiveDateTime,
}
<span class="boring">}</span></code></pre></pre>
<h3 id="newsession"><a class="header" href="#newsession">NewSession</a></h3>
<p>For creating new sessions:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>#[derive(Debug, Clone, PartialEq, Eq, Insertable, Serialize, Deserialize)]
#[diesel(table_name = sessions)]
pub struct NewSession {
    pub id: String,
    pub campaign_id: String,
    pub session_number: i32,
    pub date: chrono::NaiveDate,
    pub summary: Option&lt;String&gt;,
    pub notes: Option&lt;String&gt;,
    pub participants: Option&lt;String&gt;,
}
<span class="boring">}</span></code></pre></pre>
<h3 id="updatesession"><a class="header" href="#updatesession">UpdateSession</a></h3>
<p>For modifying existing sessions:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>#[derive(Debug, Clone, PartialEq, Eq, AsChangeset, Serialize, Deserialize)]
#[diesel(table_name = sessions)]
pub struct UpdateSession {
    pub date: Option&lt;chrono::NaiveDate&gt;,
    pub summary: Option&lt;String&gt;,
    pub notes: Option&lt;String&gt;,
    pub participants: Option&lt;String&gt;,
    pub updated_at: NaiveDateTime,
}
<span class="boring">}</span></code></pre></pre>
<h2 id="rule-models"><a class="header" href="#rule-models">Rule Models</a></h2>
<h3 id="rule"><a class="header" href="#rule">Rule</a></h3>
<p>Model for D&amp;D rules and references:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>#[derive(Debug, Clone, PartialEq, Eq, Queryable, Selectable, Serialize, Deserialize)]
#[diesel(table_name = rules)]
pub struct Rule {
    pub id: String,
    pub title: String,
    pub content: String,
    pub category: String, // "spell", "class", "race", "item", etc.
    pub source: Option&lt;String&gt;, // "PHB", "DMG", etc.
    pub page_reference: Option&lt;String&gt;,
    pub created_at: NaiveDateTime,
    pub updated_at: NaiveDateTime,
}
<span class="boring">}</span></code></pre></pre>
<h3 id="newrule"><a class="header" href="#newrule">NewRule</a></h3>
<p>For creating new rules:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>#[derive(Debug, Clone, PartialEq, Eq, Insertable, Serialize, Deserialize)]
#[diesel(table_name = rules)]
pub struct NewRule {
    pub id: String,
    pub title: String,
    pub content: String,
    pub category: String,
    pub source: Option&lt;String&gt;,
    pub page_reference: Option&lt;String&gt;,
}
<span class="boring">}</span></code></pre></pre>
<h3 id="updaterule"><a class="header" href="#updaterule">UpdateRule</a></h3>
<p>For modifying existing rules:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>#[derive(Debug, Clone, PartialEq, Eq, AsChangeset, Serialize, Deserialize)]
#[diesel(table_name = rules)]
pub struct UpdateRule {
    pub title: Option&lt;String&gt;,
    pub content: Option&lt;String&gt;,
    pub category: Option&lt;String&gt;,
    pub source: Option&lt;String&gt;,
    pub page_reference: Option&lt;String&gt;,
    pub updated_at: NaiveDateTime,
}
<span class="boring">}</span></code></pre></pre>
<h2 id="embedding-models"><a class="header" href="#embedding-models">Embedding Models</a></h2>
<h3 id="embeddingmetadata"><a class="header" href="#embeddingmetadata">EmbeddingMetadata</a></h3>
<p>Model for vector embedding metadata:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>#[derive(Debug, Clone, PartialEq, Eq, Queryable, Selectable, Serialize, Deserialize)]
#[diesel(table_name = embedding_metadata)]
pub struct EmbeddingMetadata {
    pub rowid: i64,
    pub content_type: String, // "npc", "plot", "rule", etc.
    pub content_id: String,
    pub content_text: String,
    pub created_at: String,
}
<span class="boring">}</span></code></pre></pre>
<h3 id="newembeddingmetadata"><a class="header" href="#newembeddingmetadata">NewEmbeddingMetadata</a></h3>
<p>For creating new embedding records:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>#[derive(Debug, Clone, PartialEq, Eq, Insertable, Serialize, Deserialize)]
#[diesel(table_name = embedding_metadata)]
pub struct NewEmbeddingMetadata {
    pub content_type: String,
    pub content_id: String,
    pub content_text: String,
}
<span class="boring">}</span></code></pre></pre>
<h2 id="common-patterns"><a class="header" href="#common-patterns">Common Patterns</a></h2>
<h3 id="json-serialization"><a class="header" href="#json-serialization">JSON Serialization</a></h3>
<p>Several fields store JSON-serialized data:</p>
<ul>
<li><code>Campaign.settings</code>: Campaign configuration</li>
<li><code>Npc.relationships</code>: NPC relationship mappings</li>
<li><code>Npc.stats</code>: Character statistics</li>
<li><code>Plot.connections</code>: Plot interconnections</li>
<li><code>Session.participants</code>: Player/character data</li>
</ul>
<h3 id="timestamps"><a class="header" href="#timestamps">Timestamps</a></h3>
<p>All models include automatic timestamp fields:</p>
<ul>
<li><code>created_at</code>: Set on record creation</li>
<li><code>updated_at</code>: Updated on record modification</li>
</ul>
<h3 id="foreign-keys"><a class="header" href="#foreign-keys">Foreign Keys</a></h3>
<p>Models maintain referential integrity:</p>
<ul>
<li><code>Npc.campaign_id</code> ‚Üí <code>Campaign.id</code></li>
<li><code>Plot.campaign_id</code> ‚Üí <code>Campaign.id</code></li>
<li><code>Session.campaign_id</code> ‚Üí <code>Campaign.id</code></li>
<li><code>EmbeddingMetadata.content_id</code> ‚Üí Various entity IDs</li>
</ul>
<h3 id="diesel-traits"><a class="header" href="#diesel-traits">Diesel Traits</a></h3>
<p>All models implement standard Diesel traits:</p>
<ul>
<li><code>Queryable</code>: For SELECT operations</li>
<li><code>Selectable</code>: For type-safe column selection</li>
<li><code>Insertable</code>: For INSERT operations</li>
<li><code>AsChangeset</code>: For UPDATE operations</li>
<li><code>Serialize</code>/<code>Deserialize</code>: For JSON conversion</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="api-documentation"><a class="header" href="#api-documentation">API Documentation</a></h1>
<p>This section contains comprehensive API documentation for all Mimir crates, automatically generated from the Rust source code.</p>
<h2 id="crates-overview"><a class="header" href="#crates-overview">Crates Overview</a></h2>
<h3 id="core-types"><a class="header" href="#core-types"><a href="reference/api/./core.html">Core Types</a></a></h3>
<p><strong><code>mimir-dm-core</code></strong> - Fundamental data structures, traits, and shared types.</p>
<p>Key components:</p>
<ul>
<li>Campaign, NPC, Plot, Session, and Rule data structures</li>
<li>Storage and LLM provider traits</li>
<li>Agent framework interfaces</li>
<li>Search and query types</li>
</ul>
<h3 id="database-layer"><a class="header" href="#database-layer"><a href="reference/api/./database.html">Database Layer</a></a></h3>
<p><strong><code>mimir-dm-db</code></strong> - Database operations, migrations, and storage implementations.</p>
<p>Key components:</p>
<ul>
<li>SQLite storage implementation with sqlite-vec integration</li>
<li>Database models and schema definitions</li>
<li>Migration management</li>
<li>FTS5 and vector search implementations</li>
</ul>
<h3 id="ai-integration"><a class="header" href="#ai-integration"><a href="reference/api/./ai.html">AI Integration</a></a></h3>
<p><strong><code>mimir-dm-ai</code></strong> - LLM integration and embedding generation.</p>
<p>Key components:</p>
<ul>
<li>Ollama HTTP client</li>
<li>Embedding generation and caching</li>
<li>Model management and configuration</li>
<li>Streaming response handling</li>
</ul>
<h3 id="agent-framework"><a class="header" href="#agent-framework"><a href="reference/api/./agents.html">Agent Framework</a></a></h3>
<p><strong><code>mimir-dm-agents</code></strong> - Agent implementations and coordination.</p>
<p>Key components:</p>
<ul>
<li>NPC management agent</li>
<li>Plot tracking agent</li>
<li>Session orchestration agent</li>
<li>Rule advisor agent</li>
</ul>
<h3 id="tui-components"><a class="header" href="#tui-components"><a href="reference/api/./tui.html">TUI Components</a></a></h3>
<p><strong><code>mimir-dm-tui</code></strong> - Terminal user interface components and widgets.</p>
<p>Key components:</p>
<ul>
<li>Main application loop</li>
<li>Campaign view components</li>
<li>NPC and plot management interfaces</li>
<li>Search and query interfaces</li>
</ul>
<h2 id="quick-access"><a class="header" href="#quick-access">Quick Access</a></h2>
<ul>
<li><strong><a href="reference/api/../../target/doc/mimir_dm/index.html">Complete API Documentation</a></strong> - Full generated API docs</li>
<li><strong><a href="reference/api/../../target/doc/mimir_dm_core/index.html">Core Types</a></strong> - <code>mimir-dm-core</code> API</li>
<li><strong><a href="reference/api/../../target/doc/mimir_dm_db/index.html">Database Layer</a></strong> - <code>mimir-dm-db</code> API</li>
<li><strong><a href="reference/api/../../target/doc/mimir_dm_ai/index.html">AI Integration</a></strong> - <code>mimir-dm-ai</code> API</li>
<li><strong><a href="reference/api/../../target/doc/mimir_dm_agents/index.html">Agent Framework</a></strong> - <code>mimir-dm-agents</code> API</li>
<li><strong><a href="reference/api/../../target/doc/mimir_dm_tui/index.html">TUI Components</a></strong> - <code>mimir-dm-tui</code> API</li>
</ul>
<h2 id="usage"><a class="header" href="#usage">Usage</a></h2>
<p>The API documentation is generated using <code>cargo doc</code> and includes:</p>
<ul>
<li>Type definitions and trait implementations</li>
<li>Function signatures and parameters</li>
<li>Usage examples where available</li>
<li>Cross-references between related types</li>
</ul>
<h2 id="generating-documentation"><a class="header" href="#generating-documentation">Generating Documentation</a></h2>
<p>To generate the latest API documentation:</p>
<pre><code class="language-bash"># Generate docs for all crates
cargo doc --workspace --no-deps

# Generate and open docs in browser
cargo doc --workspace --no-deps --open

# Generate docs with private items (for contributors)
cargo doc --workspace --no-deps --document-private-items
</code></pre>
<h2 id="integration-with-mdbook"><a class="header" href="#integration-with-mdbook">Integration with mdBook</a></h2>
<p>The API documentation is integrated into this mdBook through automated scripts that:</p>
<ol>
<li>Generate fresh API docs from source code</li>
<li>Extract relevant sections for each crate</li>
<li>Format for integration with the overall documentation structure</li>
<li>Ensure cross-references work correctly</li>
</ol>
<div style="break-before: page; page-break-before: always;"></div><h1 id="core-types-1"><a class="header" href="#core-types-1">Core Types</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="database-layer-1"><a class="header" href="#database-layer-1">Database Layer</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="ai-integration-1"><a class="header" href="#ai-integration-1">AI Integration</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="agent-framework-1"><a class="header" href="#agent-framework-1">Agent Framework</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="tui-components-1"><a class="header" href="#tui-components-1">TUI Components</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="architecture-overview"><a class="header" href="#architecture-overview">Architecture Overview</a></h1>
<p>Mimir is designed as a modular, local-first D&amp;D campaign assistant built using Rust. The architecture emphasizes performance, data privacy, and extensibility through a multi-crate workspace structure.</p>
<h2 id="design-principles"><a class="header" href="#design-principles">Design Principles</a></h2>
<h3 id="local-first-architecture"><a class="header" href="#local-first-architecture">Local-First Architecture</a></h3>
<ul>
<li><strong>Offline operation</strong>: Core functionality works without internet connection</li>
<li><strong>Data privacy</strong>: All campaign data stays on your machine</li>
<li><strong>Performance</strong>: SQLite-based storage with optimized indexing</li>
<li><strong>Portability</strong>: Single binary deployment with embedded database</li>
</ul>
<h3 id="modular-design"><a class="header" href="#modular-design">Modular Design</a></h3>
<ul>
<li><strong>Separation of concerns</strong>: Each crate has a focused responsibility</li>
<li><strong>Dependency management</strong>: Clear dependency graph prevents circular references</li>
<li><strong>Testing isolation</strong>: Each module can be tested independently</li>
<li><strong>Plugin architecture</strong>: Future extensibility through well-defined interfaces</li>
</ul>
<h2 id="crate-structure"><a class="header" href="#crate-structure">Crate Structure</a></h2>
<p>The workspace consists of six specialized crates:</p>
<h3 id="mimir-dm-main-binary"><a class="header" href="#mimir-dm-main-binary"><code>mimir-dm</code> (Main Binary)</a></h3>
<p>The primary application crate that orchestrates all components:</p>
<ul>
<li><strong>Entry point</strong>: Command-line interface and application initialization</li>
<li><strong>Configuration</strong>: Global application settings and user preferences</li>
<li><strong>Orchestration</strong>: Coordinates between UI, database, and AI components</li>
<li><strong>Distribution</strong>: Single binary for end-user installation</li>
</ul>
<p>Dependencies: All other crates in the workspace</p>
<h3 id="mimir-dm-core-foundation-types"><a class="header" href="#mimir-dm-core-foundation-types"><code>mimir-dm-core</code> (Foundation Types)</a></h3>
<p>Shared data structures and traits used across all crates:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// Example core types
pub struct Campaign {
    pub id: String,
    pub name: String,
    pub description: Option&lt;String&gt;,
    pub settings: serde_json::Value,
}

pub trait StorageProvider {
    async fn create_campaign(&amp;self, campaign: &amp;Campaign) -&gt; Result&lt;()&gt;;
    async fn find_campaign(&amp;self, id: &amp;str) -&gt; Result&lt;Option&lt;Campaign&gt;&gt;;
}
<span class="boring">}</span></code></pre></pre>
<p>Key responsibilities:</p>
<ul>
<li><strong>Data models</strong>: Campaign, NPC, Plot, Session, Rule structs</li>
<li><strong>Trait definitions</strong>: Storage, LLM, and Agent interfaces</li>
<li><strong>Error handling</strong>: Centralized error types and result patterns</li>
<li><strong>Serialization</strong>: JSON schema definitions and validation</li>
</ul>
<h3 id="mimir-dm-db-database-layer"><a class="header" href="#mimir-dm-db-database-layer"><code>mimir-dm-db</code> (Database Layer)</a></h3>
<p>Database operations and storage management:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// Example storage implementation
pub struct SqliteStorage {
    conn: Arc&lt;Mutex&lt;rusqlite::Connection&gt;&gt;,
}

impl StorageProvider for SqliteStorage {
    async fn create_campaign(&amp;self, campaign: &amp;Campaign) -&gt; Result&lt;()&gt; {
        // Implementation using prepared statements
    }
}
<span class="boring">}</span></code></pre></pre>
<p>Key features:</p>
<ul>
<li><strong>SQLite integration</strong>: Using Diesel ORM for type-safe queries</li>
<li><strong>Vector search</strong>: sqlite-vec integration for semantic similarity</li>
<li><strong>Full-text search</strong>: FTS5 indexes for text-based queries</li>
<li><strong>Migration management</strong>: Schema versioning and upgrades</li>
<li><strong>Connection pooling</strong>: Efficient database access patterns</li>
</ul>
<h3 id="mimir-dm-ai-ai-integration"><a class="header" href="#mimir-dm-ai-ai-integration"><code>mimir-dm-ai</code> (AI Integration)</a></h3>
<p>Large Language Model integration and embedding generation:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// Example AI client
pub struct OllamaClient {
    base_url: String,
    client: reqwest::Client,
}

impl LLMProvider for OllamaClient {
    async fn generate_embedding(&amp;self, text: &amp;str) -&gt; Result&lt;Vec&lt;f32&gt;&gt; {
        // nomic-embed-text integration
    }
    
    async fn chat_completion(&amp;self, messages: &amp;[Message]) -&gt; Result&lt;String&gt; {
        // llama3/mistral model interaction
    }
}
<span class="boring">}</span></code></pre></pre>
<p>Key capabilities:</p>
<ul>
<li><strong>Ollama integration</strong>: Local LLM server communication</li>
<li><strong>Embedding generation</strong>: Text-to-vector conversion for semantic search</li>
<li><strong>Model management</strong>: Support for multiple models (llama3, mistral)</li>
<li><strong>Streaming responses</strong>: Real-time AI-generated content</li>
<li><strong>Caching</strong>: Intelligent caching of embeddings and responses</li>
</ul>
<h3 id="mimir-dm-agents-agent-framework"><a class="header" href="#mimir-dm-agents-agent-framework"><code>mimir-dm-agents</code> (Agent Framework)</a></h3>
<p>Specialized AI agents for D&amp;D-specific tasks:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// Example agent implementation
pub struct NPCAgent {
    storage: Arc&lt;dyn StorageProvider&gt;,
    llm: Arc&lt;dyn LLMProvider&gt;,
}

impl NPCAgent {
    pub async fn generate_personality(&amp;self, npc: &amp;NPC) -&gt; Result&lt;String&gt; {
        // AI-powered personality generation
    }
    
    pub async fn suggest_dialogue(&amp;self, context: &amp;DialogueContext) -&gt; Result&lt;Vec&lt;String&gt;&gt; {
        // Context-aware dialogue suggestions
    }
}
<span class="boring">}</span></code></pre></pre>
<p>Agent types:</p>
<ul>
<li><strong>NPC Agent</strong>: Character creation and management</li>
<li><strong>Plot Agent</strong>: Story arc tracking and suggestions</li>
<li><strong>Session Agent</strong>: Game session orchestration</li>
<li><strong>Rule Agent</strong>: D&amp;D rule lookup and interpretation</li>
</ul>
<h3 id="mimir-dm-tui-terminal-interface"><a class="header" href="#mimir-dm-tui-terminal-interface"><code>mimir-dm-tui</code> (Terminal Interface)</a></h3>
<p>Text-based user interface using Ratatui:</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// Example TUI component
pub struct CampaignView {
    campaigns: Vec&lt;Campaign&gt;,
    selected: usize,
}

impl Widget for CampaignView {
    fn render(self, area: Rect, buf: &amp;mut Buffer) {
        // Render campaign list with selection
    }
}
<span class="boring">}</span></code></pre></pre>
<p>UI components:</p>
<ul>
<li><strong>Campaign management</strong>: Create, edit, and switch campaigns</li>
<li><strong>NPC browser</strong>: Search and manage non-player characters</li>
<li><strong>Plot tracker</strong>: Visualize story arcs and connections</li>
<li><strong>Session logger</strong>: Record game sessions and notes</li>
<li><strong>Search interface</strong>: Unified search across all content types</li>
</ul>
<h2 id="data-flow-architecture"><a class="header" href="#data-flow-architecture">Data Flow Architecture</a></h2>
<h3 id="request-flow"><a class="header" href="#request-flow">Request Flow</a></h3>
<ol>
<li><strong>User input</strong> ‚Üí TUI layer captures user interactions</li>
<li><strong>Command parsing</strong> ‚Üí Main binary interprets user commands</li>
<li><strong>Business logic</strong> ‚Üí Core types and agent processing</li>
<li><strong>Data access</strong> ‚Üí Database layer with optimized queries</li>
<li><strong>AI integration</strong> ‚Üí LLM calls for enhanced functionality</li>
<li><strong>Response rendering</strong> ‚Üí TUI displays results to user</li>
</ol>
<h3 id="search-architecture"><a class="header" href="#search-architecture">Search Architecture</a></h3>
<p>Mimir implements hybrid search combining multiple strategies:</p>
<ol>
<li><strong>Keyword search</strong>: FTS5 indexes for exact term matching</li>
<li><strong>Semantic search</strong>: Vector embeddings for conceptual similarity</li>
<li><strong>Filtered search</strong>: Category and metadata filtering</li>
<li><strong>Ranked results</strong>: Relevance scoring across search types</li>
</ol>
<h3 id="event-system"><a class="header" href="#event-system">Event System</a></h3>
<ul>
<li><strong>Database triggers</strong>: Automatic FTS index maintenance</li>
<li><strong>AI background processing</strong>: Embedding generation queue</li>
<li><strong>State synchronization</strong>: UI updates on data changes</li>
<li><strong>Error propagation</strong>: Structured error handling throughout the stack</li>
</ul>
<h2 id="technology-stack-1"><a class="header" href="#technology-stack-1">Technology Stack</a></h2>
<h3 id="core-technologies"><a class="header" href="#core-technologies">Core Technologies</a></h3>
<ul>
<li><strong>Rust</strong>: Systems programming language for performance and safety</li>
<li><strong>SQLite</strong>: Embedded database with advanced search capabilities</li>
<li><strong>Diesel</strong>: Type-safe ORM for database operations</li>
<li><strong>Tokio</strong>: Async runtime for concurrent operations</li>
<li><strong>Ratatui</strong>: Terminal UI framework</li>
</ul>
<h3 id="aiml-integration"><a class="header" href="#aiml-integration">AI/ML Integration</a></h3>
<ul>
<li><strong>Ollama</strong>: Local LLM server for privacy-preserving AI</li>
<li><strong>sqlite-vec</strong>: Vector similarity search extension</li>
<li><strong>nomic-embed-text</strong>: 384-dimensional embedding model</li>
<li><strong>FTS5</strong>: Full-text search with advanced tokenization</li>
</ul>
<h3 id="development-tools"><a class="header" href="#development-tools">Development Tools</a></h3>
<ul>
<li><strong>Cargo</strong>: Rust package management and build system</li>
<li><strong>mdBook</strong>: Documentation generation with Diataxis structure</li>
<li><strong>Diesel CLI</strong>: Database migration management</li>
<li><strong>Make</strong>: Task automation and build orchestration</li>
</ul>
<h2 id="performance-characteristics"><a class="header" href="#performance-characteristics">Performance Characteristics</a></h2>
<h3 id="database-performance"><a class="header" href="#database-performance">Database Performance</a></h3>
<ul>
<li><strong>Query optimization</strong>: Strategic indexing for common patterns</li>
<li><strong>Vector search</strong>: O(log n) similarity queries via sqlite-vec</li>
<li><strong>Connection management</strong>: Shared connection pool across components</li>
<li><strong>Transaction batching</strong>: Bulk operations for data imports</li>
</ul>
<h3 id="memory-management"><a class="header" href="#memory-management">Memory Management</a></h3>
<ul>
<li><strong>Zero-copy deserialization</strong>: Efficient data structure handling</li>
<li><strong>Streaming processing</strong>: Large dataset handling without memory pressure</li>
<li><strong>Resource pooling</strong>: Reuse of expensive objects (DB connections, HTTP clients)</li>
<li><strong>Garbage collection</strong>: Rust‚Äôs ownership model eliminates GC overhead</li>
</ul>
<h3 id="concurrent-operations"><a class="header" href="#concurrent-operations">Concurrent Operations</a></h3>
<ul>
<li><strong>Async architecture</strong>: Non-blocking I/O for all external operations</li>
<li><strong>Background processing</strong>: AI operations don‚Äôt block UI</li>
<li><strong>Database transactions</strong>: ACID compliance with concurrent access</li>
<li><strong>Error isolation</strong>: Component failures don‚Äôt cascade</li>
</ul>
<h2 id="security-considerations"><a class="header" href="#security-considerations">Security Considerations</a></h2>
<h3 id="data-privacy"><a class="header" href="#data-privacy">Data Privacy</a></h3>
<ul>
<li><strong>Local storage</strong>: No cloud dependencies for core functionality</li>
<li><strong>Encryption at rest</strong>: SQLite database encryption options</li>
<li><strong>Network isolation</strong>: AI processing happens locally via Ollama</li>
<li><strong>Audit trails</strong>: Database-level change tracking</li>
</ul>
<h3 id="input-validation"><a class="header" href="#input-validation">Input Validation</a></h3>
<ul>
<li><strong>Type safety</strong>: Rust‚Äôs type system prevents many common errors</li>
<li><strong>SQL injection prevention</strong>: Parameterized queries via Diesel</li>
<li><strong>JSON schema validation</strong>: Structured data validation</li>
<li><strong>User input sanitization</strong>: XSS and injection attack prevention</li>
</ul>
<p>This architecture provides a solid foundation for building a comprehensive D&amp;D campaign assistant while maintaining high performance, data privacy, and extensibility.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="search-strategy"><a class="header" href="#search-strategy">Search Strategy</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="agent-framework-2"><a class="header" href="#agent-framework-2">Agent Framework</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="performance-considerations"><a class="header" href="#performance-considerations">Performance Considerations</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="adr-001-sqlite-with-vector-extensions"><a class="header" href="#adr-001-sqlite-with-vector-extensions">ADR-001: SQLite with Vector Extensions</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="adr-002-agent-communication-patterns"><a class="header" href="#adr-002-agent-communication-patterns">ADR-002: Agent Communication Patterns</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="adr-003-tui-framework-selection"><a class="header" href="#adr-003-tui-framework-selection">ADR-003: TUI Framework Selection</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="contributing"><a class="header" href="#contributing">Contributing</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="development-setup"><a class="header" href="#development-setup">Development Setup</a></h1>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->


                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">

            </nav>

        </div>

        <!-- Livereload script (if served using the cli tool) -->
        <script>
            const wsProtocol = location.protocol === 'https:' ? 'wss:' : 'ws:';
            const wsAddress = wsProtocol + "//" + location.host + "/" + "__livereload";
            const socket = new WebSocket(wsAddress);
            socket.onmessage = function (event) {
                if (event.data === "reload") {
                    socket.close();
                    location.reload();
                }
            };

            window.onbeforeunload = function() {
                socket.close();
            }
        </script>



        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->
        <script src="mermaid.min.js"></script>
        <script src="mermaid-init.js"></script>

        <script>
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>

    </div>
    </body>
</html>
