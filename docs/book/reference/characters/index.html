<!DOCTYPE HTML>
<html lang="en" class="navy sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Character &amp; NPC Management - Mimir - D&amp;D Campaign Assistant</title>


        <!-- Custom HTML head -->

        <meta name="description" content="A local-first D&amp;D campaign assistant for Dungeon Masters">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../../favicon.svg">
        <link rel="shortcut icon" href="../../favicon.png">
        <link rel="stylesheet" href="../../css/variables.css">
        <link rel="stylesheet" href="../../css/general.css">
        <link rel="stylesheet" href="../../css/chrome.css">
        <link rel="stylesheet" href="../../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="../../highlight.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="../../tomorrow-night.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "../../";
            const default_light_theme = "navy";
            const default_dark_theme = "navy";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../../toc.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>←</kbd> or <kbd>→</kbd> to navigate between chapters</p>
                <p>Press <kbd>S</kbd> or <kbd>/</kbd> to search in the book</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('navy')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search (`/`)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="/ s" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Mimir - D&amp;D Campaign Assistant</h1>

                    <div class="right-buttons">
                        <a href="../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/mimir-dm/mimir" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        <a href="https://github.com/mimir-dm/mimir/edit/main/docs/src/reference/characters/README.md" title="Suggest an edit" aria-label="Suggest an edit">
                            <i id="git-edit-button" class="fa fa-edit"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="character-and-npc-management"><a class="header" href="#character-and-npc-management">Character and NPC Management</a></h1>
<p>Mimir provides a comprehensive character management system for tracking player characters and non-player characters within campaigns. The system handles the full lifecycle of D&amp;D 5e characters, from creation through leveling, spell slot tracking, and version history.</p>
<h2 id="data-model"><a class="header" href="#data-model">Data Model</a></h2>
<p>Players represent the real people at your table. Each player record stores a name and optional email address, and can be associated with multiple characters across different campaigns through the campaign_players relationship table.</p>
<p>Characters are the in-game personas controlled by players or the DM. A character record contains the character name, race, class, and level alongside the six ability scores. The system tracks current, maximum, and temporary hit points separately to support combat scenarios. Each character also maintains armor class, movement speed, proficiency selections, class features, known and prepared spells with slot tracking, and a complete inventory.</p>
<p>The distinction between player characters and NPCs is handled through the player_id field. When this field is null, the character is treated as an NPC. When it references a valid player record, the character appears in player-specific views and receives full character sheet treatment.</p>
<h2 id="spell-slot-calculation"><a class="header" href="#spell-slot-calculation">Spell Slot Calculation</a></h2>
<p>The spell slot system automatically calculates available slots based on class and level. Full casters such as Wizard, Cleric, Druid, Bard, and Sorcerer follow the standard progression table. Half casters including Paladin and Ranger gain slots at half the rate, while third casters like Eldritch Knight and Arcane Trickster progress even more slowly. Warlocks use the separate Pact Magic system with fewer slots that recover on short rest.</p>
<p>Multiclass characters have their slots calculated according to the multiclassing rules, summing effective caster levels from each class before consulting the appropriate progression table. The system stores both the calculated slot maximums and current availability, updating the latter when spells are cast or rests are taken.</p>
<h2 id="character-versioning"><a class="header" href="#character-versioning">Character Versioning</a></h2>
<p>Significant character changes create version snapshots in the database. These snapshots capture the complete character state at moments like level advancement, major stat modifications, or class feature acquisitions. The version history allows reviewing a character’s progression over time and can help resolve questions about when particular changes occurred.</p>
<h2 id="tauri-commands"><a class="header" href="#tauri-commands">Tauri Commands</a></h2>
<p>The character system exposes its functionality through Tauri commands that the frontend invokes via IPC. These commands follow a consistent pattern of accepting structured parameters and returning ApiResponse wrappers containing either the requested data or an error message.</p>
<h3 id="player-commands"><a class="header" href="#player-commands">Player Commands</a></h3>
<p>The <code>create_player</code> command accepts a name and optional email, returning the newly created player record. The <code>get_player</code> command retrieves a single player by ID, while <code>list_players</code> returns all registered players. Updates are handled through <code>update_player</code> which accepts the player ID and a partial update object. The <code>delete_player</code> command removes a player and cascades to remove their campaign associations.</p>
<h3 id="character-commands"><a class="header" href="#character-commands">Character Commands</a></h3>
<p>Character creation is handled by <code>create_character</code> for full character data or <code>create_minimal_character</code> for quick stubs that can be fleshed out later. The <code>create_npc</code> command provides a streamlined path for NPCs that skips player association.</p>
<p>Retrieval commands include <code>get_character</code> for a single character by ID and three listing commands scoped to campaigns: <code>list_characters_for_campaign</code> returns all characters, <code>list_pcs_for_campaign</code> filters to player characters only, and <code>list_npcs_for_campaign</code> returns NPCs exclusively.</p>
<p>The <code>update_character</code> command accepts a character ID and partial update object for modifying existing characters. The <code>level_up_character</code> command handles level advancement including hit point recalculation, proficiency bonus updates, and spell slot adjustments. Characters are linked to campaigns through <code>assign_character_to_campaign</code>.</p>
<h3 id="spell-commands"><a class="header" href="#spell-commands">Spell Commands</a></h3>
<p>The <code>get_character_spell_slots</code> command returns current slot status including both maximums and remaining uses. The <code>add_spell_to_known</code> command adds a spell to the character’s repertoire by spell ID. Prepared spell selection is handled through <code>prepare_spells</code> which accepts a list of spell IDs from the known spells.</p>
<p>Casting uses the <code>cast_spell</code> command with character ID, spell ID, and the slot level being expended. The command validates slot availability before marking the slot as used. Resource recovery happens through <code>take_rest</code> which accepts the rest type (short or long) and restores appropriate slots and features.</p>
<h2 id="frontend-integration"><a class="header" href="#frontend-integration">Frontend Integration</a></h2>
<p>The frontend provides a character creation wizard that guides users through race and class selection, ability score assignment, and initial equipment choices. The character sheet view displays all statistics, abilities, and equipment in a format familiar to tabletop players. Spell management includes a preparation interface supporting drag-and-drop organization of known spells into prepared slots.</p>
<h2 id="llm-tool-integration"><a class="header" href="#llm-tool-integration">LLM Tool Integration</a></h2>
<p>The AI assistant accesses character data through dedicated tools that wrap the Tauri commands. Natural language requests like “What are Thorin’s hit points?” or “Cast fireball at 4th level” are translated into appropriate tool calls. The assistant can create characters, modify statistics, manage spells, and handle rests through conversational interaction. See the LLM Tools documentation for the complete list of character-related tools.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../../campaign-framework/06-templates/index.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../../reference/sources/index.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../../campaign-framework/06-templates/index.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../../reference/sources/index.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../../elasticlunr.min.js"></script>
        <script src="../../mark.min.js"></script>
        <script src="../../searcher.js"></script>

        <script src="../../clipboard.min.js"></script>
        <script src="../../highlight.js"></script>
        <script src="../../book.js"></script>

        <!-- Custom JS scripts -->
        <script src="../../mermaid.min.js"></script>
        <script src="../../mermaid-init.js"></script>


    </div>
    </body>
</html>
