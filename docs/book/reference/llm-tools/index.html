<!DOCTYPE HTML>
<html lang="en" class="navy sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>LLM Tools System - Mimir - D&amp;D Campaign Assistant</title>


        <!-- Custom HTML head -->

        <meta name="description" content="A local-first D&amp;D campaign assistant for Dungeon Masters">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../../favicon.svg">
        <link rel="shortcut icon" href="../../favicon.png">
        <link rel="stylesheet" href="../../css/variables.css">
        <link rel="stylesheet" href="../../css/general.css">
        <link rel="stylesheet" href="../../css/chrome.css">
        <link rel="stylesheet" href="../../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="../../highlight.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="../../tomorrow-night.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "../../";
            const default_light_theme = "navy";
            const default_dark_theme = "navy";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../../toc.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>←</kbd> or <kbd>→</kbd> to navigate between chapters</p>
                <p>Press <kbd>S</kbd> or <kbd>/</kbd> to search in the book</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('navy')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search (`/`)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="/ s" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Mimir - D&amp;D Campaign Assistant</h1>

                    <div class="right-buttons">
                        <a href="../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/mimir-dm/mimir" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        <a href="https://github.com/mimir-dm/mimir/edit/main/docs/src/reference/llm-tools/README.md" title="Suggest an edit" aria-label="Suggest an edit">
                            <i id="git-edit-button" class="fa fa-edit"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="llm-tools-system"><a class="header" href="#llm-tools-system">LLM Tools System</a></h1>
<p>Mimir’s AI assistant uses a tool system that enables interaction with campaign data through natural language. When you ask questions like “What are Thorin’s current hit points?” or request actions like “Cast fireball at 4th level,” the assistant translates these into tool calls that query and modify the underlying database.</p>
<h2 id="architecture"><a class="header" href="#architecture">Architecture</a></h2>
<p>Tools are implemented as Rust structs that implement the <code>ToolTrait</code> interface. Each tool provides a name, description, JSON schema for its parameters, and an async execute method that performs the actual work. The ToolRegistry collects all available tools at session start, generates tool definitions for the LLM provider, and routes execution requests to the appropriate implementation.</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>pub trait ToolTrait {
    fn name(&amp;self) -&gt; &amp;str;
    fn description(&amp;self) -&gt; &amp;str;
    fn parameters(&amp;self) -&gt; Value;
    async fn execute(&amp;self, args: Value) -&gt; Result&lt;String&gt;;
}
<span class="boring">}</span></code></pre></pre>
<p>The registry provides tool definitions in the format expected by LLM providers, allowing the model to understand what tools are available and how to call them. When the model responds with a tool call, the registry looks up the tool by name and invokes its execute method with the provided arguments.</p>
<h2 id="react-pattern"><a class="header" href="#react-pattern">ReAct Pattern</a></h2>
<p>The assistant uses a Reasoning and Acting pattern for complex tasks. Before taking action, it analyzes what needs to be done through explicit THOUGHT steps. It then executes the appropriate ACTION by calling tools. After receiving results, it makes OBSERVATION notes about what succeeded or failed and what to do next. This cycle repeats until the task is complete.</p>
<p>The system prompt instructs the model to use <code>&lt;thought&gt;</code> blocks for visible reasoning on multi-step workflows, debugging scenarios, and complex character operations. Simple lookups and single-step operations skip the explicit reasoning to keep responses concise.</p>
<h2 id="available-tools"><a class="header" href="#available-tools">Available Tools</a></h2>
<h3 id="character-tools"><a class="header" href="#character-tools">Character Tools</a></h3>
<p>The <code>get_character</code> tool retrieves complete character data including stats, inventory, and spells for a given character ID. The <code>list_campaign_characters</code> tool returns all characters in a campaign, with <code>list_pcs</code> and <code>list_npcs</code> variants for filtering by character type. The <code>list_players</code> tool returns registered players for associating with characters. The <code>get_character_stats</code> tool provides a focused view of ability scores, saves, and skills. The <code>check_spell_slots</code> tool returns current spell slot availability.</p>
<p>For modifications, <code>create_character</code> handles full PC creation while <code>create_npc</code> provides a streamlined path for non-player characters. The <code>update_character</code> tool modifies character attributes, and <code>update_character_hp</code> specifically handles damage and healing. The <code>level_up</code> tool advances a character and recalculates derived statistics. The <code>cast_spell</code> tool expends a spell slot of the appropriate level. The <code>take_rest</code> tool handles short and long rest resource recovery.</p>
<h3 id="inventory-tools"><a class="header" href="#inventory-tools">Inventory Tools</a></h3>
<p>The <code>add_inventory_item</code> tool adds items to a character’s inventory by name or catalog reference. The <code>remove_inventory_item</code> tool removes items by inventory entry ID. The <code>update_equipped</code> tool changes which items are currently equipped. The <code>update_currency</code> tool modifies gold, silver, copper, and other currency amounts.</p>
<h3 id="catalog-search-tools"><a class="header" href="#catalog-search-tools">Catalog Search Tools</a></h3>
<p>The <code>search_monsters</code> tool queries the monster catalog with filters for name, challenge rating, creature type, size, and alignment. The <code>search_spells</code> tool searches spells by name, level, school, and class list. The <code>search_items</code> tool finds equipment and magic items by name, type, and rarity.</p>
<h3 id="module-tools"><a class="header" href="#module-tools">Module Tools</a></h3>
<p>The <code>create_module</code> tool creates new adventure modules within a campaign. The <code>list_modules</code> tool returns all modules for a campaign. The <code>get_module</code> tool retrieves module details including status and session count. The <code>update_module_status</code> tool tracks module progress through planning, active, and completed states.</p>
<h3 id="file-tools"><a class="header" href="#file-tools">File Tools</a></h3>
<p>When a campaign is active, file tools become available for managing campaign documents. The <code>read_file</code> tool retrieves file contents from the campaign directory. The <code>write_file</code> tool creates or overwrites files. The <code>edit_file</code> tool modifies specific line ranges within existing files. The <code>list_files</code> tool returns the campaign directory structure.</p>
<h3 id="utility-tools"><a class="header" href="#utility-tools">Utility Tools</a></h3>
<p>The <code>todo_write</code> tool manages a task list for tracking progress on multi-step operations. The assistant uses this to show users what steps it plans to take and mark items complete as it works through complex requests.</p>
<h2 id="tool-execution-flow"><a class="header" href="#tool-execution-flow">Tool Execution Flow</a></h2>
<p>When the assistant decides to use a tool, it includes a tool_calls array in its response specifying the tool name and arguments. The ChatProcessor extracts these calls and routes them through the ToolRegistry. Each tool executes asynchronously and returns a string result. The processor collects all results and sends them back to the model in a follow-up message, allowing the model to interpret the results and decide whether to make additional tool calls or provide a final response.</p>
<p>The system limits tool execution to 20 iterations per request to prevent infinite loops. Most requests complete in one to three iterations depending on complexity.</p>
<h2 id="adding-custom-tools"><a class="header" href="#adding-custom-tools">Adding Custom Tools</a></h2>
<p>Creating a new tool requires implementing the ToolTrait interface on a struct. The name method returns the tool identifier used in LLM responses. The description method provides text that helps the model understand when to use the tool. The parameters method returns a JSON schema defining the expected arguments. The execute method performs the actual work, returning a string result or error.</p>
<p>Register the new tool in the <code>register_all_tools</code> function in <code>tools/mod.rs</code>. The tool automatically becomes available in subsequent chat sessions.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../../reference/pdf-export/index.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../../reference/frontend/index.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../../reference/pdf-export/index.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../../reference/frontend/index.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../../elasticlunr.min.js"></script>
        <script src="../../mark.min.js"></script>
        <script src="../../searcher.js"></script>

        <script src="../../clipboard.min.js"></script>
        <script src="../../highlight.js"></script>
        <script src="../../book.js"></script>

        <!-- Custom JS scripts -->
        <script src="../../mermaid.min.js"></script>
        <script src="../../mermaid-init.js"></script>


    </div>
    </body>
</html>
