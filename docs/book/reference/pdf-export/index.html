<!DOCTYPE HTML>
<html lang="en" class="navy sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>PDF Export - Mimir - D&amp;D Campaign Assistant</title>


        <!-- Custom HTML head -->

        <meta name="description" content="A local-first D&amp;D campaign assistant for Dungeon Masters">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../../favicon.svg">
        <link rel="shortcut icon" href="../../favicon.png">
        <link rel="stylesheet" href="../../css/variables.css">
        <link rel="stylesheet" href="../../css/general.css">
        <link rel="stylesheet" href="../../css/chrome.css">
        <link rel="stylesheet" href="../../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="../../highlight.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="../../tomorrow-night.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "../../";
            const default_light_theme = "navy";
            const default_dark_theme = "navy";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../../toc.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>←</kbd> or <kbd>→</kbd> to navigate between chapters</p>
                <p>Press <kbd>S</kbd> or <kbd>/</kbd> to search in the book</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('navy')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search (`/`)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="/ s" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Mimir - D&amp;D Campaign Assistant</h1>

                    <div class="right-buttons">
                        <a href="../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/mimir-dm/mimir" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        <a href="https://github.com/mimir-dm/mimir/edit/main/docs/src/reference/pdf-export/README.md" title="Suggest an edit" aria-label="Suggest an edit">
                            <i id="git-edit-button" class="fa fa-edit"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="pdf-export"><a class="header" href="#pdf-export">PDF Export</a></h1>
<p>Mimir generates PDF documents from campaign data using <a href="https://typst.app/">Typst</a>, a modern typesetting system. The PDF export functionality lives in the mimir-dm-print crate and supports character sheets, spell cards, and campaign documents.</p>
<h2 id="template-system"><a class="header" href="#template-system">Template System</a></h2>
<p>The export system uses Typst templates that define document layout and styling. Each template is a <code>.typ</code> file that receives JSON data from the application and renders it into a formatted PDF. Templates are organized by content type into character/, spells/, and campaign/ directories, with shared components in a components/ directory.</p>
<p>Character templates include a full sheet format for comprehensive character reference, a condensed summary for quick lookup, and a combined sheet-with-spells variant for spellcasters. Spell templates support individual cards, multi-up layouts for printing decks, and compact list formats. Campaign templates handle single documents like session notes as well as combined bundles that compile multiple documents into one PDF.</p>
<h2 id="rendering-pipeline"><a class="header" href="#rendering-pipeline">Rendering Pipeline</a></h2>
<p>When you request a PDF export, the application serializes the relevant data to JSON and passes it to the PrintService along with the template path. The service writes the JSON to a temporary file, invokes the Typst compiler with the template, and captures the resulting PDF bytes. These bytes can be returned as base64 for display or written directly to a file.</p>
<p>The template accesses its data through Typst’s <code>json()</code> function, reading from a data.json file that the service creates in the compilation directory. This approach keeps templates portable and testable independent of the application.</p>
<h2 id="data-format"><a class="header" href="#data-format">Data Format</a></h2>
<p>Templates expect JSON data matching the Rust structs being exported. A character export includes character_name, level, race, and class strings alongside an abilities object containing the six scores. Hit point data arrives as separate current_hp and max_hp fields. The exact schema varies by template, but follows the patterns established in the domain model.</p>
<pre><code class="language-json">{
  "character_name": "Thorin Ironforge",
  "level": 5,
  "race": "Dwarf",
  "class": "Cleric",
  "abilities": {
    "strength": 14,
    "dexterity": 10,
    "constitution": 16,
    "intelligence": 12,
    "wisdom": 18,
    "charisma": 8
  },
  "current_hp": 38,
  "max_hp": 45
}
</code></pre>
<h2 id="tauri-commands"><a class="header" href="#tauri-commands">Tauri Commands</a></h2>
<div class="table-wrapper"><table><thead><tr><th>Command</th><th>Parameters</th><th>Description</th></tr></thead><tbody>
<tr><td><code>generate_pdf</code></td><td>template_path, data</td><td>Render a template to PDF and return base64</td></tr>
<tr><td><code>list_templates</code></td><td>—</td><td>List available templates with metadata</td></tr>
<tr><td><code>save_pdf</code></td><td>path, pdf_base64</td><td>Write base64 PDF data to a file</td></tr>
</tbody></table>
</div>
<h2 id="printservice-api"><a class="header" href="#printservice-api">PrintService API</a></h2>
<p>The Rust PrintService provides the underlying functionality that the Tauri commands wrap. Creating a service requires passing the templates root directory. The <code>render_to_pdf</code> method accepts a template path relative to that root and a serializable data reference, returning PDF bytes on success. The <code>save_pdf</code> method writes those bytes to a specified path. The <code>list_templates</code> method scans the templates directory and returns metadata for each discovered template. The <code>template_exists</code> method provides a quick check for template availability.</p>
<h2 id="custom-templates"><a class="header" href="#custom-templates">Custom Templates</a></h2>
<p>Adding custom templates requires creating a new <code>.typ</code> file in the appropriate templates subdirectory. The template should read its data using <code>json("data.json")</code> and use Typst markup to define the document structure. Once saved, the template appears automatically in the <code>list_templates</code> output and can be used with <code>generate_pdf</code>.</p>
<p>Typst documentation at <a href="https://typst.app/docs/">typst.app/docs</a> covers the markup language, styling options, and available functions. Templates can import shared components and use Typst’s full typesetting capabilities including custom fonts, vector graphics, and complex layouts.</p>
<h2 id="troubleshooting"><a class="header" href="#troubleshooting">Troubleshooting</a></h2>
<p>PDF generation failures usually stem from template syntax errors or missing data fields. Verify the template compiles independently using the Typst CLI before integrating with the application. Check that all fields referenced in the template exist in the provided data.</p>
<p>Font rendering issues occur when templates reference fonts not available on the system. Typst uses system fonts by default, so either install the required fonts or modify templates to use bundled alternatives. Font names must match exactly including capitalization.</p>
<p>Large PDFs typically result from embedded raster images. Optimize images before including them in exports, prefer vector graphics where possible, and consider splitting very large documents into multiple PDFs.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../../reference/sources/index.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../../reference/llm-tools/index.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../../reference/sources/index.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../../reference/llm-tools/index.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../../elasticlunr.min.js"></script>
        <script src="../../mark.min.js"></script>
        <script src="../../searcher.js"></script>

        <script src="../../clipboard.min.js"></script>
        <script src="../../highlight.js"></script>
        <script src="../../book.js"></script>

        <!-- Custom JS scripts -->
        <script src="../../mermaid.min.js"></script>
        <script src="../../mermaid-init.js"></script>


    </div>
    </body>
</html>
